---
output: rmarkdown::github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file. -->

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(rrails)
```

# rrails

[![Build Status](https://travis-ci.org/atheriel/rrails.svg?branch=master)](https://travis-ci.org/atheriel/rrails)

This package provides a new pipe operator, `%>>=%` (pronounced "bind") for
writing failure-tolerant R code. Its approach is inspired by Scott Wlaschin's
articles and talks about ["Railroad Oriented Programming"](https://fsharpforfunandprofit.com/rop/) in
in the F# language.

## Overview

The bind operator works by wrapping the right-hand side in a `tryCatch` block
and returning an S3 object of class `"result"` wrapping either the result of the
call, or the error if one occured. This is useful when dealing with, for
example, untrusted user input:

```{r simple-example-1}
untrusted_input <- 100
(good <- as_result(untrusted_input) %>>=% log(base = 10) %>>=% sin())
```

Which works just fine, versus

```{r simple-example-2}
untrusted_input <- "one hundred"
(bad <- as_result(untrusted_input) %>>=% log(base = 10) %>>=% sin())
```

which does not. Notice that the code does not actually raise an error.

You can inspect the return value and "unwrap" it (to borrow the term from the
Rust language) to get the underlying value, or raise its error if it has one:

```{r simple-example-3}
if (result_is_ok(good)) unwrap_result(good)
if (!result_is_error(bad)) unwrap_result(bad)
```

As a slightly more realistic example, the bind operator allows writing code that
looks like the following:

```{r validation-example}
library(magrittr)

validate_username <- function(user) {
  if (nchar(user$name) > 10) {
    stop("username too long; must be 10 chars or fewer")
  }
  user
}

validate_email <- function(user) {
  if (!grepl("[a-zA-Z]+@[a-zA-Z\\.]+", user$email)) {
    stop("invalid email address")
  }
  user
}

list(name = "Dr. Oak", email = "oak@@pkmn.jk") %>%
  as_result() %>>=%
  validate_username() %>>=%
  validate_email()

list(name = "Albus Dumbledor", email = "albus@hogwarts.co.uk") %>%
  as_result() %>>=%
  validate_username() %>>=%
  validate_email()
```

## Installation

**rrails** is not yet available on CRAN, so for now you'll have to install it
from GitHub:

```{r, eval = FALSE}
# install.packages("devtools")
devtools::install_github("atheriel/rrails")
```
